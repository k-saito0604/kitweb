<!DOCTYPE html>
<html lang="ja-jp">

  <head>
  <meta charset="utf-8">

 <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>[GGH4.0] クライアント印刷機能が有効な時，印刷画面の表示に時間がかかる （VB6 Printers コレクション） ．</title>
  
  <meta name="author" content="kitasp" />
  
  
  
  
  <meta name="keywords" content="devows, hugo, go">
  
  
  <meta name="description" content="きっとエイエスピーのホームページ">

  <meta name="generator" content="Hugo 0.69.0" />

  
  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.11.2/css/all.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">
  

  
  <link href="/css/custom.css" rel="stylesheet">


  
  <link href="/js/slick.css" rel="stylesheet">
  <link href="/js/slick-theme.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />

  
  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="きっとエイエスピーはGlaphOn社GO-Globalの総代理店">

  
  
  
  
  
  
  
  <meta property="og:locale" content="ja_jp">
  <meta property="og:site_name" content="きっとエイエスピーはGlaphOn社GO-Globalの総代理店">
  <meta property="og:title" content="[GGH4.0] クライアント印刷機能が有効な時，印刷画面の表示に時間がかかる （VB6 Printers コレクション） ．">
  <meta property="og:type" content="website">
  <meta property="og:url" content="/technews/doc1049/" />
  <meta property="og:description" content="きっとエイエスピーのホームページ">
  <meta property="og:image" content="img/technote.jpg">
  <meta property="og:image:type" content="image/jpg">
  
  
  
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="288">
  
  
  <meta property="og:updated_time" content="2012-04-09T00:00:00Z">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="[GGH4.0] クライアント印刷機能が有効な時，印刷画面の表示に時間がかかる （VB6 Printers コレクション） ．">
  
  <meta name="twitter:image" content="img/technote.jpg">
  
  <meta name="twitter:description" content="きっとエイエスピーのホームページ">
  


  <script defer src="https://www.gstatic.com/firebase/5.3.1/firebase-app.js"></script>
  <script defer src="https://www.gstatic.com/firebase/5.3.1/firebase-storage.js"></script>
  <script defer src="https://www.gstatic.com/firebase/5.3.1/firebase-auth.js"></script>
  <script defer src="https://www.gstatic.com/firebase/init.js"></script>
  <script src="https://cdn.firebase.com/libs/firebaseui/3.1.1/firebaseui.js"></script>
  <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.1.1/firebaseui.css" />
  <script src="/js/config.js"></script>

</head>


  <body>

    <div id="all">

        <header>
          
<div id="top">
  <div class="container">
    <div class="row">
      <div class="col-xs-5">
        <a href="https://www.kitasp.com/"><img src="/img/logo_s.png/" alt="[GGH4.0] クライアント印刷機能が有効な時，印刷画面の表示に時間がかかる （VB6 Printers コレクション） ． logo" class=""></a>
      </div>
      <div class="col-xs-7">
        </div>
      </div>
    </div>
  </div>
</div>



          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="500">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="/">
                    <img src="/img/logo-go-small.png" alt="[GGH4.0] クライアント印刷機能が有効な時，印刷画面の表示に時間がかかる （VB6 Printers コレクション） ． logo" class="hidden-xs hidden-sm">
                    <img src="/img/logo-go-small.png" alt="[GGH4.0] クライアント印刷機能が有効な時，印刷画面の表示に時間がかかる （VB6 Printers コレクション） ． logo" class="visible-xs visible-sm">
                    <span class="sr-only">[GGH4.0] クライアント印刷機能が有効な時，印刷画面の表示に時間がかかる （VB6 Printers コレクション） ． - ホームへ戻る</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">ナビゲーションの切り替え</span>
                        <i class="fas fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  <div class = "topbotton">
                    <a href="https://www.kitasp.com/contact/"target="_blank" class="btn-square-shadow-ora">問い合わせ<i class="fas fa-external-link-alt"></i></a>
                    <a href="https://gitbook.kitasp.com/"target="_blank" class="btn-square-shadow">技術サイト<i class="fas fa-external-link-alt"></i></a>
                    <a href="https://www.kitasp.com/downloads/"target="_blank" class="btn-square-shadow-old">ダウンロード<i class="fas fa-external-link-alt"></i></a><br>
                    <a class="fas fa-search" href="/search">ページ検索</a>
                  </div>
                  
                  
                  
                  <li class="dropdown">
                    
                    <a href="/go-global/">GO-Globalとは</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/go-use/">GO-Global活用</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a class="dropdown-toggle" href="/case-study" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="linkmenu">導入事例</span><span class="caret"></span></a>
                    <ul class="dropdown-menu">
                      
                        <li>
                          <a href="/adaptation-facility-1">医療現場</a>
                        </li>
                      
                        <li>
                          <a href="/adaptation-facility-2">ISV</a>
                        </li>
                      
                        <li>
                          <a href="/adaptation-facility-3">中小企業</a>
                        </li>
                      
                        <li>
                          <a href="/adaptation-facility-4">BCP対策</a>
                        </li>
                      
                        <li>
                          <a href="/adaptation-facility-5">教育現場</a>
                        </li>
                      
                    </ul>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/faq/">FAQ</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a href="/partners-list/">代理店一覧</a>
                    
                  </li>
                  
                  
                  <li class="dropdown">
                    
                    <a class="dropdown-toggle" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="linkmenu">　　サポート　　</span><span class="caret"></span></a>
                    <ul class="dropdown-menu">
                      
                        <li>
                          <a href="/support-schedule/">サポートスケジュール</a>
                        </li>
                      
                        <li>
                          <a href="/pdf/go-global-support.pdf">サポートの流れ</a>
                        </li>
                      
                        <li>
                          <a href="">サポートポリシー</a>
                        </li>
                      
                    </ul>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fas fa-search"></i></button>
                </span>
                    </div>
                </form>
            </div>
            

        </div>
    </div>
    

</div>




        </header>


        <div id="content">
            <div class="container">

                <div class="row">
                  
                    

                    <div class="col-md-9" id="blog-post">

                        
                          <p class="text-muted text-uppercase mb-small text-right">
                            
                            
                            2012-04-09
                          </p>
                        
                      
                        <div id="post-content">
                          <hr>
<p>*技術ノート</p>
<p>2012/04/09*</p>
<p>[番号]
技術ノート KGTN 2012011201</p>
<p>[現象]
[GGH4.0] クライアント印刷機能が有効な時，印刷画面の表示に時間がかかる
（VB6 Printers コレクション） ．</p>
<p>[説明]
状況を確認するために弊社ツール GGPrinterCheck.exe
を実行して下さい．このプログラムは，セッション上で利用できるプリンタを数え上げ，その時に要した時間を画面に表示します．下記の例では，20台のプリンタが存在し，最初は１台当り約1.2秒，最後は１台当り約1.9秒，全体で34秒要していることを示しています．</p>
<p>弊社でさまざまな検証や実験を行った結果，この問題は &ldquo;VB6 のPrinters
コレクション&rdquo;
を利用した場合に発生することが判明しました．ソースコードがある場合は，Printers
コレクション ではなく　EnumPrinters 関数
を使用してプリンタリストを作成することで問題が解消します．上記説明と同じ条件で　EnumPrinters
関数
を使用して実行したところ，次頁の画面の通り1秒未満で全てのプリンタがリストされました．</p>
<p>&ldquo;VB6 のPrinters コレクション&rdquo;
を利用した場合の現象については，現在GraphOn社へ問い合わせを行っており，回答が届き次第この技術ノートに反映します．場合によっては，
VB6 と GGH4.0
それぞれのアーキテクチャに起因する制限事項という可能性があります．</p>
<p>補足１
&ldquo;VB6 のPrinters コレクション&rdquo; を利用した場合に遅くなる原因は，Windows
のサービス &ldquo;Spooler&rdquo; のプロセス （spoolersv.exe）
がCPUを非常に多く消費していることに起因しています．恐らく，　&ldquo;VB6
のPrinters コレクション&rdquo;
が効率の良くない処理を行っており，GGのクライアント印刷機能が有効な場合，その処理
（APIをフックしてクライアント側のプリンタも含めてプリンタを数え上げる処理）
が加わり，プリント・スプーラーの負荷が高まったのではないかと推測されます．なお，
EnumPrinters 関数を使用した場合は，プリント・スプーラーのCPU使用率は0%
（またはほぼ0%） です．</p>
<p>補足２
マイクロソフト社の Process Monitor というツールで spoolersv.exe
の挙動を確認したところ，レジストリ &ldquo;HKCU¥Printers¥Connections&rdquo; について
RegOpenKey ? RegQueryKey ? RegEnumKey ? RegCloseKey
という処理を極めて多く繰り返して行っており，このことがCPUを非常に多く消費している原因だと考えられます．なお，この現象は
Windows Server 2008 および Windows Server 2003
の両方の環境で確認することが出来ました．また， Performance Auto-Tuning
(ClientProcessingBatch = 1) を有効にしても，状況に変化はありません．</p>
<p>補足３
補足２について，プリンタ数を5台，10台，20台
と増やして問題のレジストリのアクセス回数を確認しました．5台で400回，10台で1400回，20台で5000回で，プリンタ数が2倍になると，アクセス回数が約3.5倍になります．このようなことから，
&ldquo;VB6 のPrinters コレクション&rdquo; が二重ループのような処理でプリンタを
（非効率に） 探しているのではないかと推測されます．
補足４
(2012-01-27) GraphOn社は， VB6 のPrinters
コレクションの処理とGGH4.0のクライアント印刷機能の相性に起因する問題だと認識し，
GGH4.0.1 Patch 5 で VB6 のPrinters コレクションの処理 （問題）
に対応するとのことです</p>
<p>(2012-02-23) GraphOn社より， 「技術検証用のビルドを準備中」
との連絡がありました．弊社へ提供され次第，そのビルドで問題が解消するかどうか検証を行います．</p>
<p>(2012-02-24) 技術検証用のビルドで試験したところ，１台当り 0ms 〜 16ms
で処理されました （22台のプリンタで約1秒） ．従って， GGH4.0.1 Patch 5
でこの問題が解消されることは確実だと思われます．</p>
<p>(2012-04-04) GGH4.0.1 Patch 5 (4.0.1.12187)
で，この問題が修正されました．</p>
<h3 id="ファイル">ファイル</h3>
<p><a href="http://techreport.kitasp.net/attachments/download/792/KGTN2012011201.pdf">KGTN2012011201.pdf</a>
[(251 KB)] [kitasp 技術センター, 2012/04/09
09:26]</p>

                        </div>
                        
                        
                        
                    
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">検索</h3>
    </div>

    <div class="panel-body">
        <form action="https://cse.google.com/cse?cx=004221574702554897620:tgludhvdjca" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="検索">
                <input type="hidden" name="sitesearch" value="/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fas fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
        <h3 class="panel-title">カテゴリー</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            
            <li>
                <a href="/categories/news">news (15)</a>
            </li>
            
        </ul>
    </div>

</div>








<div class="panel sidebar-menu">

    <div class="panel-heading">
        <h3 class="panel-title">タグ</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            
            <li>
                <a href="/tags/news"><i class="fas fa-tags"></i> news</a>
            </li>
            
            <li>
                <a href="/tags/windowsupdate"><i class="fas fa-tags"></i> windowsupdate</a>
            </li>
            
        </ul>
    </div>

</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

                <footer id="footer">
        <div class="footer-nav-wrapper">        
        <div class="container">
            
    <div class="col-md-12">
        <div class="footer-nav-line">
            <div class="col-md-3 col-sm-3">
                <div class="footer-nav-column">
                    <div class="footer-nav-column-title"></div>
                    <div class="footer-nav-column-content">

                        <ul>
                            <li>
                                <a href="/go-global/">GO-Globalとは</a>
                            </li>        
                        <li>
<ul>
                            <li>
                                <a href="/gg-use/">GO-Globalの活用方法</a>
                            </li>        
                        <li>

                                    </div>
                    </div>
                </div>
                <hr class="hidden-md hidden-lg hidden-sm">
                <div class="col-md-3 col-sm-3">
                    <div class="footer-nav-column">
                        <div class="footer-nav-column-title"></div>
                       <div class="footer-nav-column-content">
                  
                        <ul>
 <li>
                              <a href="/case-study/">導入事例</a>
 </li>
                            <li>
                                <a href="/adaptation-facility-1/">医療現場</a>
                            </li>
                            <li>
                                <a href="/adaptation-facility-2/">ISV</a>
                            </li>
                            <li>
                                <a href="/adaptation-facility-3/">中小企業</a>
                            </li>
                            <li>
                                <a href="/adaptation-facility-4/">BCP対策</a>
                            </li>
                            <li>
                                <a href="/adaptation-facility-5/">教育現場</a>
                            </li>
                        </ul>
                    </div>
                </div>
                </div>
                <hr class="hidden-md hidden-lg hidden-sm">
                        <div class="col-md-3 col-sm-3">
                            <div class="footer-nav-column">
                                <div class="footer-nav-column-title"></div>
                                <div class="footer-nav-column-content">


                        <ul>
 <li>
                             <a href="/faq/">FAQ</a>
 </li>


                                 
                                    <a href="/partners-list/">代理店一覧</a><br>
                                    <a href="/contact/">問い合せ<i class="fas fa-external-link-alt"></i></a><br>
                                    <a href="/technical-site/">技術サイト<i class="fas fa-external-link-alt"></i></a><br>            
                                    <a href="/technical-site/">ダウンロード<i class="fas fa-external-link-alt"></i></a><br>            
                                </div>
                                
                            </div>
                            <hr class="hidden-md hidden-lg hidden-sm">
                
                        </div>
                <div class="col-md-3 col-sm-3">
                    <div class="footer-nav-column">
                        <div class="footer-nav-column-content">
                        <div class="footer-nav-column-a">
                        サポート
                        <ul>
                            <li>
                                <a href="/support-schedule/">スケジュール</a>
                            </li>        
                        <li>
                            <a href="/pdf/go-global-support.pdf">サポートの流れ</a>
                        </li>
                        <li>
                            <a href="/philosophy/">サポートポリシー</a>
</li>
<li>
<a href="/privacy-policy/">個人情報保護方針<i class="fas fa-external-link-alt"></i></a>
                   <li> <a href="/history/">クッキーポリシー<i class="fas fa-external-link-alt"></i></a>
                     
                    </ul>
                    
                
                </div>
            </div>
        </div>
        </div>
        
    </div>
    </div>
        </div>
    
</footer>







<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            <div class="col-xs-5">
            
           <p style="text-align:center;">Copyright © 2020 KitASP Corp. All Rights Reserved</p>
            
        </div>
                
                    <div class="col-xs-7">
                        <div class="social">
                          
                        <a href="https://www.facebook.com/kitasp2000/" target="_blank" style="opacity: 1;"><i class='fab fa-2x fa-facebook'></i></a>
                        
                        <a href="https://twitter.com/KitASP_Corp" target="_blank" style="opacity: 1;"><i class='fab fa-2x fa-twitter'></i></a>
                        
                        <a href="https://www.instagram.com/kitasp_corp/" target="_blank" style="opacity: 1;"><i class='fab fa-2x fa-instagram'></i></a>
                        
                </div>
                </div>
        </div>
    </div>
</div>







    </div>
    

    
<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="/js/jquery.zoom.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>

<script src="//maps.googleapis.com/maps/api/js?v=3.exp"></script>

<script src="/js/hpneo.gmaps.js"></script>
<script src="/js/gmaps.init.js"></script>
<script src="/js/front.js"></script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js" type="text/javascript"></script>
<script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<script src="/js/owl.carousel.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.4/css/all.css">

<script src="/js/slick.min.js"></script>



  </body>
</html>
